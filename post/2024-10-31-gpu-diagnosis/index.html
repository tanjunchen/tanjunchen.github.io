<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:site_name" content="漫步远方，心荡神往"><meta property="og:type" content="article"><meta property="og:image" content="https://tanjunchen.github.io/img/home.webp"><meta property="twitter:image" content="https://tanjunchen.github.io/img/home.webp"><meta name=title content="NVIDIA GPU 系统诊断与运维排查手册：常用命令与一键脚本指南"><meta property="og:title" content="NVIDIA GPU 系统诊断与运维排查手册：常用命令与一键脚本指南"><meta property="twitter:title" content="NVIDIA GPU 系统诊断与运维排查手册：常用命令与一键脚本指南"><meta name=description content="本文系统整理了在使用 NVIDIA GPU 及其他加速卡时常见的系统诊断工具与命令，覆盖硬件信息、操作系统状态、内核日志、网络互联（OFED/Fabric）、IPMI 管理以及 NVIDIA 专属监控工具（如 nvidia-smi、nvidia-bug-report.sh） 等关键维度，为 GPU 用户提供全面的系统诊断工具箱。"><meta property="og:description" content="本文系统整理了在使用 NVIDIA GPU 及其他加速卡时常见的系统诊断工具与命令，覆盖硬件信息、操作系统状态、内核日志、网络互联（OFED/Fabric）、IPMI 管理以及 NVIDIA 专属监控工具（如 nvidia-smi、nvidia-bug-report.sh） 等关键维度，为 GPU 用户提供全面的系统诊断工具箱。"><meta property="twitter:description" content="本文系统整理了在使用 NVIDIA GPU 及其他加速卡时常见的系统诊断工具与命令，覆盖硬件信息、操作系统状态、内核日志、网络互联（OFED/Fabric）、IPMI 管理以及 NVIDIA 专属监控工具（如 nvidia-smi、nvidia-bug-report.sh） 等关键维度，为 GPU 用户提供全面的系统诊断工具箱。"><meta property="twitter:card" content="summary"><meta name=keyword content="陈谭军, 互联网, 云原生, 容器, 微服务, Web, PaaS, Istio, Kubernetes, Microservice"><link rel="shortcut icon" href=/img/favicon.ico><title>NVIDIA GPU 系统诊断与运维排查手册：常用命令与一键脚本指南 | 陈谭军的博客 | tanjunchen Blog</title><link rel=canonical href=/post/2024-10-31-gpu-diagnosis/><link rel=stylesheet href=/css/bootstrap.min.css><link rel=stylesheet href=/css/hugo-theme-cleanwhite.min.css><link rel=stylesheet href=/css/zanshang.css><link rel=stylesheet href=/css/font-awesome.all.min.css><script src=/js/jquery.min.js></script>
<script src=/js/bootstrap.min.js></script>
<script src=/js/hux-blog.min.js></script>
<script src=/js/lazysizes.min.js></script></head><nav class="navbar navbar-default navbar-custom navbar-fixed-top"><div class=container-fluid><div class="navbar-header page-scroll"><button type=button class=navbar-toggle>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span></button>
<a class=navbar-brand href=/>漫步远方，心荡神往</a></div><div id=huxblog_navbar><div class=navbar-collapse><ul class="nav navbar-nav navbar-right"><li><a href=/>All Posts</a></li><li><a href=/categories/technology/>technology</a></li><li><a href=/categories/think/>think</a></li><li><a href=/learning/>LEARNING</a></li><li><a href=/archive/>ARCHIVE</a></li><li><a href=/about/>ABOUT</a></li><li><a href=/search><i class="fa fa-search"></i></a></li></ul></div></div></div></nav><script>var $body=document.body,$toggle=document.querySelector(".navbar-toggle"),$navbar=document.querySelector("#huxblog_navbar"),$collapse=document.querySelector(".navbar-collapse");$toggle.addEventListener("click",handleMagic);function handleMagic(){$navbar.className.indexOf("in")>0?($navbar.className=" ",setTimeout(function(){$navbar.className.indexOf("in")<0&&($collapse.style.height="0px")},400)):($collapse.style.height="auto",$navbar.className+=" in")}</script><style type=text/css>header.intro-header{background-image:url(/img/home.webp)}</style><header class=intro-header><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><div class=tags><a class=tag href=/tags/gpu title=GPU>GPU</a>
<a class=tag href=/tags/nvidia title=NVIDIA>NVIDIA</a>
<a class=tag href=/tags/%E5%A4%A7%E6%A8%A1%E5%9E%8B title=大模型>大模型</a></div><h1>NVIDIA GPU 系统诊断与运维排查手册：常用命令与一键脚本指南</h1><h2 class=subheading>全面掌握 GPU 系统诊断：从硬件到驱动的一站式排查指南</h2><span class=meta>Posted by
陈谭军
on
Saturday, October 26, 2024
<span id=busuanzi_container_page_pv>|<span id=busuanzi_value_page_pv></span><span>
<span id=/post/2024-10-31-gpu-diagnosis/ class="leancloud_visitors meta_data_item" data-flag-title><span class=post-meta-item-icon><span class="octicon octicon-eye"></span></span>
<i class="fa fa-eye"></i>
<span class=old-visitors-count style=display:none></span>
<span class=leancloud-visitors-count></span></span>
<script src=https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js></script>
<script>AV.initialize("","")</script><script type=text/javascript>function showTime(e){var n=new AV.Query(e),t=[],s=$(".leancloud_visitors");s.each(function(){t.push($(this).attr("id").trim())}),n.containedIn("url",t),n.find().done(function(e){for(var s,o,i,a,r,c,l=".leancloud-visitors-count",d=".old-visitors-count",n=0;n<e.length;n++)a=e[n],i=a.get("url"),c=a.get("time"),s=document.getElementById(i),$(s).find(l).text(c);for(n=0;n<t.length;n++)i=t[n],s=document.getElementById(i),o=$(s).find(l),o.text()==""&&(r=$(s).find(d).text(),r!=""?o.text(0+parseInt(r)):o.text(0))}).fail(function(e,t){console.log("Error: "+t.code+" "+t.message)})}function addCount(e){var n=$(".leancloud_visitors"),t=n.attr("id").trim(),o=n.attr("data-flag-title").trim(),s=new AV.Query(e);s.equalTo("url",t),s.find({success:function(n){if(n.length>0){var s,i,r,c,l,a=n[0];a.fetchWhenSave(!0),a.increment("time"),a.save(null,{success:function(e){var n=$(document.getElementById(t));n.find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to save Visitor num, with error message: "+t.message)}})}else s=new e,i=new AV.ACL,i.setPublicReadAccess(!0),i.setPublicWriteAccess(!0),s.setACL(i),s.set("title",o),s.set("url",t),c=".old-visitors-count",l=$(document.getElementById(t)),r=l.find(c).text(),r!=""?s.set("time",parseInt(r)+1):s.set("time",1),s.save(null,{success:function(e){var n=$(document.getElementById(t));n.find(".leancloud-visitors-count").text(e.get("time"))},error:function(){console.log("Failed to create")}})},error:function(e){console.log("Error:"+e.code+" "+e.message)}})}$(function(){var e=AV.Object.extend("Counter");$(".leancloud_visitors").length==1?addCount(e):showTime(e)})</script>阅读 </span></span>|<span class=post-date>共 2015 字</span>，阅读约 <span class=more-meta>5 分钟</span></span></div></div></div></div></header><article><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
post-container"><h1 id=gpu-常见排查工具与命令>GPU 常见排查工具与命令</h1><h2 id=查看系统信息>查看系统信息</h2><table><thead><tr><th>检查项</th><th>命令/方法</th><th>说明</th></tr></thead><tbody><tr><td>硬件厂商</td><td><code>dmidecode -t system</code> (提取 Manufacturer)</td><td>获取系统制造商信息</td></tr><tr><td>CPU 型号</td><td><code>awk -F': ' '/model name/{print $2; exit}' /proc/cpuinfo</code></td><td>提取 CPU 型号名称</td></tr><tr><td>操作系统</td><td><code>awk -F'"' '/PRETTY_NAME/{print $2}' /etc/os-release</code></td><td>显示操作系统名称（如 Ubuntu 20.04）</td></tr><tr><td>内核版本</td><td><code>uname -r</code></td><td>查看当前运行的内核版本</td></tr><tr><td>OFED 版本</td><td><code>ofed_info -s</code></td><td>查看 InfiniBand OFED 驱动版本</td></tr><tr><td>主机 IP</td><td><code>hostname -I | awk '{print $1}'</code></td><td>获取主机第一个 IP 地址</td></tr><tr><td>内核日志</td><td><code>dmesg</code></td><td>打印或控制内核环形缓冲区</td></tr><tr><td>系统日志</td><td><code>cat /var/log/messages</code></td><td>查看系统日志消息（常见于较老系统）</td></tr><tr><td>OS 信息</td><td><code>cat /etc/issue</code><br><code>uname -r</code><br><code>cat /etc/*-release</code></td><td>收集操作系统发行版、内核版本等详细信息</td></tr><tr><td>Fabric 日志</td><td><code>cat /var/log/fabricmanager.log</code></td><td>查看 NVIDIA Fabric Manager 日志</td></tr><tr><td>内核模块</td><td><code>lsmod</code></td><td>显示当前已加载的内核模块</td></tr><tr><td>PCI 设备</td><td><code>lspci -tv</code><br><code>lspci -vvd 10de:</code><br><code>lspci -vvv</code><br><code>lspci -xxxx</code></td><td>以不同详细级别查看 PCI 设备信息（特别是 NVIDIA 设备）</td></tr><tr><td>CPU 信息</td><td><code>lscpu</code><br><code>cpupower frequency-info</code></td><td>显示 CPU 架构、核心数、频率等信息</td></tr><tr><td>Systemd 日志</td><td><code>journalctl --since "10 days ago"</code><br><code>journalctl | head -n 15000</code></td><td>查看 systemd 管理的日志（按时间或行数限制）</td></tr><tr><td>IPMI 信息</td><td><code>ipmitool fru list</code><br><code>ipmitool sdr list</code><br><code>ipmitool sel list</code></td><td>列出 IPMI 的 FRU（硬件资产）、传感器数据和系统事件日志</td></tr><tr><td>NVIDIA 驱动</td><td><code>ls /sys/class/video/*</code><br><code>modinfo $(modprobe -n nvidia)</code><br><code>rpm -qa | grep fabric</code></td><td>查看 NVIDIA 驱动模块文件及相关软件包</td></tr><tr><td>NVIDIA SMI</td><td><code>nvidia-smi</code><br><code>nvidia-smi -q</code><br><code>nvidia-smi topo -m</code></td><td>查看 GPU 状态、详细信息及拓扑结构</td></tr><tr><td>GPU ECC</td><td><code>nvidia-smi -q | grep -A 5 "ECC Errors|Memory Location|Remapped Rows"</code></td><td>提取 GPU 的 ECC 错误和内存重映射情况</td></tr><tr><td>NVIDIA Bug 报告</td><td><code>nvidia-bug-report.sh</code></td><td>运行 NVIDIA 官方错误报告脚本，生成诊断压缩包</td></tr></tbody></table><h2 id=gpu-显存占用>GPU 显存占用</h2><p>使用 python 打印 GPU 显存占用信息脚本如下所示：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>import</span> torch
</span></span><span style=display:flex><span><span style=color:#ff79c6>import</span> subprocess
</span></span><span style=display:flex><span><span style=color:#ff79c6>from</span> pynvml <span style=color:#ff79c6>import</span> <span style=color:#ff79c6>*</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>device <span style=color:#ff79c6>=</span> torch<span style=color:#ff79c6>.</span>device(<span style=color:#f1fa8c>&#39;cuda&#39;</span> <span style=color:#ff79c6>if</span> torch<span style=color:#ff79c6>.</span>cuda<span style=color:#ff79c6>.</span>is_available() <span style=color:#ff79c6>else</span> <span style=color:#f1fa8c>&#39;cpu&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>print</span>(torch<span style=color:#ff79c6>.</span>cuda<span style=color:#ff79c6>.</span>get_device_properties(device))
</span></span><span style=display:flex><span>result <span style=color:#ff79c6>=</span> subprocess<span style=color:#ff79c6>.</span>run([<span style=color:#f1fa8c>&#39;nvidia-smi&#39;</span>], stdout<span style=color:#ff79c6>=</span>subprocess<span style=color:#ff79c6>.</span>PIPE, stderr<span style=color:#ff79c6>=</span>subprocess<span style=color:#ff79c6>.</span>PIPE, text<span style=color:#ff79c6>=</span><span style=color:#ff79c6>True</span>)
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>print</span>(result<span style=color:#ff79c6>.</span>stdout)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>nvmlInit()
</span></span><span style=display:flex><span>handle <span style=color:#ff79c6>=</span> nvmlDeviceGetHandleByIndex(<span style=color:#bd93f9>0</span>)
</span></span><span style=display:flex><span>uuid <span style=color:#ff79c6>=</span> nvmlDeviceGetUUID(handle)
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>print</span>(<span style=color:#f1fa8c>f</span><span style=color:#f1fa8c>&#34;gpu uuid </span><span style=color:#f1fa8c>{</span>uuid<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c> &#34;</span>)
</span></span><span style=display:flex><span>info <span style=color:#ff79c6>=</span> nvmlDeviceGetMemoryInfo(handle)
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>print</span>(<span style=color:#f1fa8c>f</span><span style=color:#f1fa8c>&#34;总显存: </span><span style=color:#f1fa8c>{</span>info<span style=color:#ff79c6>.</span>total<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>print</span>(<span style=color:#f1fa8c>f</span><span style=color:#f1fa8c>&#34;已使用显存: </span><span style=color:#f1fa8c>{</span>info<span style=color:#ff79c6>.</span>used<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>print</span>(<span style=color:#f1fa8c>f</span><span style=color:#f1fa8c>&#34;剩余显存: </span><span style=color:#f1fa8c>{</span>info<span style=color:#ff79c6>.</span>free<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>bytes_in_gb <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>1024</span> <span style=color:#ff79c6>**</span> <span style=color:#bd93f9>3</span>
</span></span><span style=display:flex><span>desired_memory_gb <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>5</span>
</span></span><span style=display:flex><span>desired_memory_bytes <span style=color:#ff79c6>=</span> desired_memory_gb <span style=color:#ff79c6>*</span> bytes_in_gb
</span></span><span style=display:flex><span>float_size <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>4</span>
</span></span><span style=display:flex><span>num_floats <span style=color:#ff79c6>=</span> desired_memory_bytes <span style=color:#ff79c6>//</span> float_size
</span></span><span style=display:flex><span><span style=color:#ff79c6>try</span>:
</span></span><span style=display:flex><span>  tensor <span style=color:#ff79c6>=</span> torch<span style=color:#ff79c6>.</span>cuda<span style=color:#ff79c6>.</span>FloatTensor(num_floats)
</span></span><span style=display:flex><span>  <span style=color:#8be9fd;font-style:italic>print</span>(<span style=color:#f1fa8c>f</span><span style=color:#f1fa8c>&#34;success </span><span style=color:#f1fa8c>{</span>desired_memory_gb<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c> GB&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#ff79c6>except</span> RuntimeError <span style=color:#ff79c6>as</span> e:
</span></span><span style=display:flex><span>  <span style=color:#8be9fd;font-style:italic>print</span>(<span style=color:#f1fa8c>f</span><span style=color:#f1fa8c>&#34;fail: </span><span style=color:#f1fa8c>{</span>e<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>&#34;</span>)
</span></span><span style=display:flex><span>  info <span style=color:#ff79c6>=</span> nvmlDeviceGetMemoryInfo(handle)
</span></span><span style=display:flex><span>  <span style=color:#8be9fd;font-style:italic>print</span>(<span style=color:#f1fa8c>f</span><span style=color:#f1fa8c>&#34;总显存: </span><span style=color:#f1fa8c>{</span>info<span style=color:#ff79c6>.</span>total<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>&#34;</span>)
</span></span><span style=display:flex><span>  <span style=color:#8be9fd;font-style:italic>print</span>(<span style=color:#f1fa8c>f</span><span style=color:#f1fa8c>&#34;已使用显存: </span><span style=color:#f1fa8c>{</span>info<span style=color:#ff79c6>.</span>used<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>&#34;</span>)
</span></span><span style=display:flex><span>  <span style=color:#8be9fd;font-style:italic>print</span>(<span style=color:#f1fa8c>f</span><span style=color:#f1fa8c>&#34;剩余显存: </span><span style=color:#f1fa8c>{</span>info<span style=color:#ff79c6>.</span>free<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>&#34;</span>)
</span></span><span style=display:flex><span>nvmlShutdown()
</span></span></code></pre></div><h2 id=一键统计-gpu-信息>一键统计 gpu 信息</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#ff79c6>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>DATE</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>`</span>date +%Y%m%d_%H%M%S<span style=color:#f1fa8c>`</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>HOSTNAME</span><span style=color:#ff79c6>=</span><span style=color:#ff79c6>$(</span>cat /etc/hostname |awk -F <span style=color:#f1fa8c>&#39;[.]&#39;</span> <span style=color:#f1fa8c>&#39;{print $1 &#34;.&#34; $2}&#39;</span><span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>SN</span><span style=color:#ff79c6>=</span><span style=color:#ff79c6>$(</span>dmidecode -t system|grep -i <span style=color:#f1fa8c>&#34;Serial Number&#34;</span> |awk <span style=color:#f1fa8c>&#39;{print $3}&#39;</span><span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>LOG_DIR</span><span style=color:#ff79c6>=</span>gpulog_sn<span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>SN</span><span style=color:#f1fa8c>}</span>_<span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>HOSTNAME</span><span style=color:#f1fa8c>}</span>_<span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>DATE</span><span style=color:#f1fa8c>}</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>LOG_NAME</span><span style=color:#ff79c6>=</span>gpulog_sn<span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>SN</span><span style=color:#f1fa8c>}</span>_<span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>HOSTNAME</span><span style=color:#f1fa8c>}</span>_<span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>DATE</span><span style=color:#f1fa8c>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>mkdir -p <span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>LOG_DIR</span><span style=color:#f1fa8c>}</span>
</span></span><span style=display:flex><span>dmesg &gt; <span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>LOG_DIR</span><span style=color:#f1fa8c>}</span>/dmesg.log
</span></span><span style=display:flex><span>cat /var/log/messages &gt; <span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>LOG_DIR</span><span style=color:#f1fa8c>}</span>/messages.log
</span></span><span style=display:flex><span>cat /etc/issue &gt;&gt; <span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>LOG_DIR</span><span style=color:#f1fa8c>}</span>/os_info.log
</span></span><span style=display:flex><span>uname -r &gt;&gt; <span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>LOG_DIR</span><span style=color:#f1fa8c>}</span>/os_info.log
</span></span><span style=display:flex><span>cat /etc/*release &gt;&gt; <span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>LOG_DIR</span><span style=color:#f1fa8c>}</span>/os_info.log
</span></span><span style=display:flex><span>cat /var/log/fabricmanager.log &gt;&gt; <span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>LOG_DIR</span><span style=color:#f1fa8c>}</span>/fabric_manger.log 2&gt;&gt;/dev/null
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>lsmod &gt;&gt;<span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>LOG_DIR</span><span style=color:#f1fa8c>}</span>/lsmod.log
</span></span><span style=display:flex><span>lspci -tv &gt; <span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>LOG_DIR</span><span style=color:#f1fa8c>}</span>/lspci_tv.log
</span></span><span style=display:flex><span>lspci -vvd 10de: &gt; <span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>LOG_DIR</span><span style=color:#f1fa8c>}</span>/lspci_gpu_vv.log 
</span></span><span style=display:flex><span>lspci -vvv &gt; <span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>LOG_DIR</span><span style=color:#f1fa8c>}</span>/lspci_vv.log 
</span></span><span style=display:flex><span>lspci -xxxx &gt; <span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>LOG_DIR</span><span style=color:#f1fa8c>}</span>/lspci_xxxx.log 
</span></span><span style=display:flex><span>lscpu   &gt; <span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>LOG_DIR</span><span style=color:#f1fa8c>}</span>/lscpu.log
</span></span><span style=display:flex><span>cpupower frequency-info  &gt; <span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>LOG_DIR</span><span style=color:#f1fa8c>}</span>/cpupower_frequency.log  2&gt;&gt;/dev/null 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>journalctl --since <span style=color:#f1fa8c>`</span>date -d <span style=color:#f1fa8c>&#34;10 days ago&#34;</span> <span style=color:#f1fa8c>&#34;+%Y-%m-%d&#34;</span><span style=color:#f1fa8c>`</span> &gt; <span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>LOG_DIR</span><span style=color:#f1fa8c>}</span>/journalctl_before_10_days.log 2&gt;&gt;/dev/null
</span></span><span style=display:flex><span>journalctl | head -n <span style=color:#bd93f9>15000</span> &gt; <span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>LOG_DIR</span><span style=color:#f1fa8c>}</span>/journalctl_head_15000.log  2&gt;&gt;/dev/null
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ipmitool fru list &gt; <span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>LOG_DIR</span><span style=color:#f1fa8c>}</span>/ipmi_fru.log  2&gt;&gt;/dev/null
</span></span><span style=display:flex><span>ipmitool sdr list &gt; <span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>LOG_DIR</span><span style=color:#f1fa8c>}</span>/ipmi_sdr.log  2&gt;&gt;/dev/null
</span></span><span style=display:flex><span>ipmitool sel list &gt; <span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>LOG_DIR</span><span style=color:#f1fa8c>}</span>/ipmi_sel.log  2&gt;&gt;/dev/null
</span></span><span style=display:flex><span>ls /lib/modules/<span style=color:#f1fa8c>`</span>uname -r<span style=color:#f1fa8c>`</span>/kernel/drivers/video/*  &gt; <span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>LOG_DIR</span><span style=color:#f1fa8c>}</span>/nvidia-driver.log  2&gt;&gt;/dev/null
</span></span><span style=display:flex><span>modinfo  /lib/modules/<span style=color:#f1fa8c>`</span>uname -r<span style=color:#f1fa8c>`</span>/kernel/drivers/video/nvidia.ko  &gt;&gt; <span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>LOG_DIR</span><span style=color:#f1fa8c>}</span>/nvidia-driver.log
</span></span><span style=display:flex><span>rpm -qa |grep -i fabric &gt;&gt;<span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>LOG_DIR</span><span style=color:#f1fa8c>}</span>/nvidia_fabric-manger.log
</span></span><span style=display:flex><span>nvidia-smi &gt; <span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>LOG_DIR</span><span style=color:#f1fa8c>}</span>/nvidia-smi.log 2&gt;&gt;/dev/null 
</span></span><span style=display:flex><span>nvidia-smi -q &gt; <span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>LOG_DIR</span><span style=color:#f1fa8c>}</span>/nvidia-smi_query.log 2&gt;&gt;/dev/null  
</span></span><span style=display:flex><span>nvidia-smi -q | grep -A <span style=color:#bd93f9>9</span> <span style=color:#f1fa8c>&#34;ECC Errors&#34;</span>|awk <span style=color:#f1fa8c>&#39;{print $1,$2,$3,$4,$5}&#39;</span> &gt;&gt;<span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>LOG_DIR</span><span style=color:#f1fa8c>}</span>/gpu_ecc.log 2&gt;&gt;/dev/null
</span></span><span style=display:flex><span>nvidia-smi -q |grep -i Remapping &gt;&gt; <span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>LOG_DIR</span><span style=color:#f1fa8c>}</span>/gpu_ecc.log  2&gt;&gt;/dev/null
</span></span><span style=display:flex><span>nvidia-smi topo -m &gt; <span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>LOG_DIR</span><span style=color:#f1fa8c>}</span>/nvidia-smi_topo.log 2&gt;&gt;/dev/null
</span></span><span style=display:flex><span>nvidia-bug-report.sh  --output-file <span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>LOG_DIR</span><span style=color:#f1fa8c>}</span>/nvidia-bug-report-sn<span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>SN</span><span style=color:#f1fa8c>}</span>_<span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>HOSTNAME</span><span style=color:#f1fa8c>}</span>.log  2&gt;&gt;/dev/null
</span></span><span style=display:flex><span>tar -zcvf <span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>LOG_NAME</span><span style=color:#f1fa8c>}</span>.tar.gz <span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>LOG_DIR</span><span style=color:#f1fa8c>}</span>
</span></span><span style=display:flex><span>rm -rf <span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>LOG_DIR</span><span style=color:#f1fa8c>}</span>
</span></span></code></pre></div><h2 id=常见排查问题命令>常见排查问题命令</h2><ol><li>基础信息收集</li></ol><ul><li><p>命令 : date +%Y%m%d_%H%M%S</p><ul><li>功能接口 : 时间戳获取</li><li>用途说明 : 获取当前时间用于日志命名</li></ul></li><li><p>命令 : cat /etc/hostname</p><ul><li>功能接口 : 主机名获取</li><li>用途说明 : 获取系统主机名</li></ul></li><li><p>命令 : dmidecode -t system</p><ul><li>功能接口 : 系统序列号获取</li><li>用途说明 : 获取硬件序列号用于标识设备</li></ul></li></ul><ol><li>系统日志收集</li></ol><ul><li><p>命令 : dmesg</p><ul><li>功能接口 : 内核日志导出</li><li>用途说明 : 导出内核环形缓冲区日志</li></ul></li><li><p>命令 : cat /var/log/messages</p><ul><li>功能接口 : 系统消息日志</li><li>用途说明 : 导出系统级消息日志</li></ul></li><li><p>命令 : journalctl &ndash;since</p><ul><li>功能接口 : systemd日志查询</li><li>用途说明 : 获取指定时间范围内的系统日志</li></ul></li><li><p>命令 : journalctl | head -n 15000</p><ul><li>功能接口 : 最新日志截取</li><li>用途说明 : 获取最新的系统日志记录</li></ul></li></ul><ol><li>操作系统信息</li></ol><ul><li><p>命令 : cat /etc/issue</p><ul><li>功能接口 : 系统提示信息</li><li>用途说明 : 获取登录前的系统提示信息</li></ul></li><li><p>命令 : uname -r</p><ul><li>功能接口 : 内核版本查询</li><li>用途说明 : 获取当前运行的内核版本</li></ul></li><li><p>命令 : cat /etc/*release</p><ul><li>功能接口 : 发行版信息</li><li>用途说明 : 获取Linux发行版本详细信息</li></ul></li></ul><ol><li>硬件信息收集</li></ol><ul><li><p>命令 : lspci -tv</p><ul><li>功能接口 : PCI设备树状显示</li><li>用途说明 : 以树状结构显示PCI设备连接关系</li></ul></li><li><p>命令 : lspci -vvd 10de:</p><ul><li>功能接口 : NVIDIA GPU详细信息</li><li>用途说明 : 显示NVIDIA GPU设备的详细配置</li></ul></li><li><p>命令 : lspci -vvv</p><ul><li>功能接口 : PCI设备详细信息</li><li>用途说明 : 显示所有PCI设备的详细信息</li></ul></li><li><p>命令 : lspci -xxxx</p><ul><li>功能接口 : PCI配置空间</li><li>用途说明 : 显示PCI设备的完整配置空间内容</li></ul></li><li><p>命令 : lscpu</p><ul><li>功能接口 : CPU架构信息</li><li>用途说明 : 显示CPU架构、核心数等信息</li></ul></li><li><p>命令 : cpupower frequency-info</p><ul><li>功能接口 : CPU频率信息</li><li>用途说明 : 显示CPU频率调节相关信息</li></ul></li></ul><ol><li>内核模块信息</li></ol><ul><li><p>命令 : lsmod</p><ul><li>功能接口 : 已加载模块列表</li><li>用途说明 : 列出当前已加载的内核模块</li></ul></li><li><p>命令 : ls /lib/modules/uname -r/kernel/drivers/video/*</p><ul><li>功能接口 : 视频驱动模块列表</li><li>用途说明 : 列出视频驱动目录下的内核模块</li></ul></li><li><p>命令 : modinfo /lib/modules/uname -r/kernel/drivers/video/nvidia.ko</p><ul><li>功能接口 : 驱动模块信息</li><li>用途说明 : 显示NVIDIA驱动模块的详细信息</li></ul></li></ul><ol><li>IPMI管理信息</li></ol><ul><li><p>命令 : ipmitool fru list</p><ul><li>功能接口 : FRU信息查询</li><li>用途说明 : 获取固件/硬件可更换单元信息</li></ul></li><li><p>命令 : ipmitool sdr list</p><ul><li>功能接口 : 传感器数据</li><li>用途说明 : 获取系统传感器数据记录</li></ul></li><li><p>命令 : ipmitool sel list</p><ul><li>功能接口 : 系统事件日志</li><li>用途说明 : 获取系统事件日志记录</li></ul></li></ul><ol><li>NVIDIA GPU 状态监控</li></ol><ul><li><p>命令 : nvidia-smi</p><ul><li>功能接口 : GPU基本状态</li><li>用途说明 : 显示GPU温度、使用率、显存等基本信息</li></ul></li><li><p>命令 : nvidia-smi -q</p><ul><li>功能接口 : GPU详细查询</li><li>用途说明 : 显示GPU的详细状态信息</li></ul></li><li><p>命令 : nvidia-smi -q | grep -A 9 &ldquo;ECC Errors&rdquo;</p><ul><li>功能接口 : ECC错误信息</li><li>用途说明 : 提取GPU ECC内存错误信息</li></ul></li><li><p>命令 : nvidia-smi -q | grep -i Remapping</p><ul><li>功能接口 : 内存重映射信息</li><li>用途说明 : 获取GPU内存重映射相关信息</li></ul></li><li><p>命令 : nvidia-smi topo -m</p><ul><li>功能接口 : GPU拓扑结构</li><li>用途说明 : 显示GPU之间的连接拓扑关系</li></ul></li><li><p>命令 : nvidia-bug-report.sh</p><ul><li>功能接口 : 官方诊断报告</li><li>用途说明 : 运行NVIDIA官方诊断脚本生成完整报告</li></ul></li></ul><ol><li>软件包与服务信息</li></ol><ul><li><p>命令 : rpm -qa | grep -i fabric</p><ul><li>功能接口 : Fabric Manager 检查</li><li>用途说明 : 检查是否安装NVIDIA Fabric Manager【机器有 NVLink 就需要开启】</li></ul></li><li><p>命令 : cat /var/log/fabricmanager.log</p><ul><li>功能接口 : Fabric Manager日志</li><li>用途说明 : 收集Fabric Manager服务日志</li></ul></li></ul><hr><ul class=pager><li class=previous><a href=/post/2024-10-20-nvidia-oom/ data-toggle=tooltip data-placement=top title="记一次 NVIDIA 卡训练任务出现 OOM 排查过程和解决思路">&larr;
Previous Post</a></li><li class=next><a href=/post/2025-01-01-happy-new-year/ data-toggle=tooltip data-placement=top title="2025 新年快乐（Happy New Year）">Next
Post &rarr;</a></li></ul></div><div class="col-lg-2 col-lg-offset-0
visible-lg-block
sidebar-container
catalog-container"><div class=side-catalog><hr class="hidden-sm hidden-xs"><h5><a class=catalog-toggle href=#>CATALOG</a></h5><ul class=catalog-body></ul></div></div><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
sidebar-container"></div></div></div></article><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center"><li><a href=mailto:tanjunchen20@gmail.com><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-envelope fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=/img/wechat.jpg><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-weixin fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=https://github.com/tanjunchen><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-github fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="copyright text-muted">Copyright &copy; 陈谭军 2025</p></div></div></div></footer><script>function loadAsync(e,t){var s=document,o="script",n=s.createElement(o),i=s.getElementsByTagName(o)[0];n.src=e,t&&n.addEventListener("load",function(e){t(null,e)},!1),i.parentNode.insertBefore(n,i)}</script><script>$("#tag_cloud").length!==0&&loadAsync("/js/jquery.tagcloud.js",function(){$.fn.tagcloud.defaults={color:{start:"#bbbbee",end:"#0085a1"}},$("#tag_cloud a").tagcloud()})</script><script>loadAsync("https://cdn.jsdelivr.net/npm/fastclick@1.0.6/lib/fastclick.min.js",function(){var e=document.querySelector("nav");e&&FastClick.attach(e)})</script><script type=text/javascript>function generateCatalog(e){_containerSelector="div.post-container";var t,n,s,o,i,r=$(_containerSelector),a=r.find("h1,h2,h3,h4,h5,h6");return $(e).html(""),a.each(function(){n=$(this).prop("tagName").toLowerCase(),i="#"+$(this).prop("id"),s=$(this).text(),t=$('<a href="'+i+'" rel="nofollow">'+s+"</a>"),o=$('<li class="'+n+'_nav"></li>').append(t),$(e).append(o)}),!0}generateCatalog(".catalog-body"),$(".catalog-toggle").click(function(e){e.preventDefault(),$(".side-catalog").toggleClass("fold")}),loadAsync("/js/jquery.nav.js",function(){$(".catalog-body").onePageNav({currentClass:"active",changeHash:!1,easing:"swing",filter:"",scrollSpeed:700,scrollOffset:0,scrollThreshold:.2,begin:null,end:null,scrollChange:null,padding:80})})</script></body></html>