<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:site_name" content="漫步远方，心荡神往"><meta property="og:type" content="article"><meta property="og:image" content="https://tanjunchen.github.io/img/home.webp"><meta property="twitter:image" content="https://tanjunchen.github.io/img/home.webp"><meta name=title content="Sidecar 在 Istio 大规模场景下性能测试"><meta property="og:title" content="Sidecar 在 Istio 大规模场景下性能测试"><meta property="twitter:title" content="Sidecar 在 Istio 大规模场景下性能测试"><meta name=description content="Istio XDS 全量下发在大规模场景下存在性能问题 * Istio 全量下发配置会导致数据面/控制面出现性能瓶颈； * 全量下发造成数据面 Envoy 配置庞大，Envoy 内存使用率较大；"><meta property="og:description" content="Istio XDS 全量下发在大规模场景下存在性能问题 * Istio 全量下发配置会导致数据面/控制面出现性能瓶颈； * 全量下发造成数据面 Envoy 配置庞大，Envoy 内存使用率较大；"><meta property="twitter:description" content="Istio XDS 全量下发在大规模场景下存在性能问题 * Istio 全量下发配置会导致数据面/控制面出现性能瓶颈； * 全量下发造成数据面 Envoy 配置庞大，Envoy 内存使用率较大；"><meta property="twitter:card" content="summary"><meta name=keyword content="陈谭军, 互联网, 云原生, 容器, 微服务, Web, PaaS, Istio, Kubernetes, Microservice"><link rel="shortcut icon" href=/img/favicon.ico><title>Sidecar 在 Istio 大规模场景下性能测试 | 陈谭军的博客 | tanjunchen Blog</title><link rel=canonical href=/post/2024-03-09-istio-sidecar-performance-test/><link rel=stylesheet href=/css/bootstrap.min.css><link rel=stylesheet href=/css/hugo-theme-cleanwhite.min.css><link rel=stylesheet href=/css/zanshang.css><link rel=stylesheet href=/css/font-awesome.all.min.css><script src=/js/jquery.min.js></script>
<script src=/js/bootstrap.min.js></script>
<script src=/js/hux-blog.min.js></script>
<script src=/js/lazysizes.min.js></script></head><nav class="navbar navbar-default navbar-custom navbar-fixed-top"><div class=container-fluid><div class="navbar-header page-scroll"><button type=button class=navbar-toggle>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span></button>
<a class=navbar-brand href=/>漫步远方，心荡神往</a></div><div id=huxblog_navbar><div class=navbar-collapse><ul class="nav navbar-nav navbar-right"><li><a href=/>All Posts</a></li><li><a href=/categories/technology/>technology</a></li><li><a href=/categories/think/>think</a></li><li><a href=/learning/>LEARNING</a></li><li><a href=/archive/>ARCHIVE</a></li><li><a href=/about/>ABOUT</a></li><li><a href=/search><i class="fa fa-search"></i></a></li></ul></div></div></div></nav><script>var $body=document.body,$toggle=document.querySelector(".navbar-toggle"),$navbar=document.querySelector("#huxblog_navbar"),$collapse=document.querySelector(".navbar-collapse");$toggle.addEventListener("click",handleMagic);function handleMagic(){$navbar.className.indexOf("in")>0?($navbar.className=" ",setTimeout(function(){$navbar.className.indexOf("in")<0&&($collapse.style.height="0px")},400)):($collapse.style.height="auto",$navbar.className+=" in")}</script><style type=text/css>header.intro-header{background-image:url(/img/home.webp)}</style><header class=intro-header><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><div class=tags><a class=tag href=/tags/kubernetes title=kubernetes>kubernetes</a>
<a class=tag href=/tags/istio title=istio>istio</a></div><h1>Sidecar 在 Istio 大规模场景下性能测试</h1><h2 class=subheading>Istio Sidecar Scope 性能测试</h2><span class=meta>Posted by
陈谭军
on
Saturday, March 9, 2024
<span id=busuanzi_container_page_pv>|<span id=busuanzi_value_page_pv></span><span>
<span id=/post/2024-03-09-istio-sidecar-performance-test/ class="leancloud_visitors meta_data_item" data-flag-title><span class=post-meta-item-icon><span class="octicon octicon-eye"></span></span>
<i class="fa fa-eye"></i>
<span class=old-visitors-count style=display:none></span>
<span class=leancloud-visitors-count></span></span>
<script src=https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js></script>
<script>AV.initialize("","")</script><script type=text/javascript>function showTime(e){var n=new AV.Query(e),t=[],s=$(".leancloud_visitors");s.each(function(){t.push($(this).attr("id").trim())}),n.containedIn("url",t),n.find().done(function(e){for(var s,o,i,a,r,c,l=".leancloud-visitors-count",d=".old-visitors-count",n=0;n<e.length;n++)a=e[n],i=a.get("url"),c=a.get("time"),s=document.getElementById(i),$(s).find(l).text(c);for(n=0;n<t.length;n++)i=t[n],s=document.getElementById(i),o=$(s).find(l),o.text()==""&&(r=$(s).find(d).text(),r!=""?o.text(0+parseInt(r)):o.text(0))}).fail(function(e,t){console.log("Error: "+t.code+" "+t.message)})}function addCount(e){var n=$(".leancloud_visitors"),t=n.attr("id").trim(),o=n.attr("data-flag-title").trim(),s=new AV.Query(e);s.equalTo("url",t),s.find({success:function(n){if(n.length>0){var s,i,r,c,l,a=n[0];a.fetchWhenSave(!0),a.increment("time"),a.save(null,{success:function(e){var n=$(document.getElementById(t));n.find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to save Visitor num, with error message: "+t.message)}})}else s=new e,i=new AV.ACL,i.setPublicReadAccess(!0),i.setPublicWriteAccess(!0),s.setACL(i),s.set("title",o),s.set("url",t),c=".old-visitors-count",l=$(document.getElementById(t)),r=l.find(c).text(),r!=""?s.set("time",parseInt(r)+1):s.set("time",1),s.save(null,{success:function(e){var n=$(document.getElementById(t));n.find(".leancloud-visitors-count").text(e.get("time"))},error:function(){console.log("Failed to create")}})},error:function(e){console.log("Error:"+e.code+" "+e.message)}})}$(function(){var e=AV.Object.extend("Counter");$(".leancloud_visitors").length==1?addCount(e):showTime(e)})</script>阅读 </span></span>|<span class=post-date>共 1607 字</span>，阅读约 <span class=more-meta>4 分钟</span></span></div></div></div></div></header><article><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
post-container"><h1 id=背景>背景</h1><p>Istio XDS 全量下发在大规模场景下存在性能问题。</p><ul><li>Istio 全量下发配置会导致数据面/控制面出现性能瓶颈；</li><li>全量下发造成数据面 Envoy 配置庞大，Envoy 内存使用率较大；</li></ul><h1 id=测试目标>测试目标</h1><p>主要目标是测试在评估（Sidecar）按需下发后 Istio 控制平面与数据平面性能（数据平面的 Envoy 内存占用与控制平面的推送时延）。</p><h1 id=性能测试>性能测试</h1><h2 id=集群信息>集群信息</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Kubernetes 版本：v1.26.9
</span></span><span style=display:flex><span>istio 版本：1.16.5 
</span></span></code></pre></div><p>测试工作负载如下所示：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ff79c6>apiVersion</span>: v1
</span></span><span style=display:flex><span><span style=color:#ff79c6>kind</span>: ServiceAccount
</span></span><span style=display:flex><span><span style=color:#ff79c6>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>name</span>: sleep
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#ff79c6>apiVersion</span>: v1
</span></span><span style=display:flex><span><span style=color:#ff79c6>kind</span>: Service
</span></span><span style=display:flex><span><span style=color:#ff79c6>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>name</span>: sleep
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>labels</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>app</span>: sleep
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>service</span>: sleep
</span></span><span style=display:flex><span><span style=color:#ff79c6>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>ports</span>:
</span></span><span style=display:flex><span>  - <span style=color:#ff79c6>port</span>: <span style=color:#bd93f9>80</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>name</span>: http
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>app</span>: sleep
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#ff79c6>apiVersion</span>: apps/v1
</span></span><span style=display:flex><span><span style=color:#ff79c6>kind</span>: Deployment
</span></span><span style=display:flex><span><span style=color:#ff79c6>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>name</span>: sleep
</span></span><span style=display:flex><span><span style=color:#ff79c6>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>replicas</span>: <span style=color:#bd93f9>1</span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>app</span>: sleep
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>metadata</span>:
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>labels</span>:
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>app</span>: sleep
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>terminationGracePeriodSeconds</span>: <span style=color:#bd93f9>0</span>
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>serviceAccountName</span>: sleep
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>containers</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ff79c6>name</span>: sleep
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>image</span>: docker.io/kennethreitz/httpbin:latest
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>command</span>: [<span style=color:#f1fa8c>&#34;/bin/sleep&#34;</span>, <span style=color:#f1fa8c>&#34;infinity&#34;</span>]
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>imagePullPolicy</span>: IfNotPresent
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>volumeMounts</span>:
</span></span><span style=display:flex><span>        - <span style=color:#ff79c6>mountPath</span>: /etc/sleep/tls
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>name</span>: secret-volume
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ff79c6>name</span>: secret-volume
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>secret</span>:
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>secretName</span>: sleep-secret
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>optional</span>: <span style=color:#ff79c6>true</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>apiVersion</span>: v1
</span></span><span style=display:flex><span><span style=color:#ff79c6>kind</span>: ServiceAccount
</span></span><span style=display:flex><span><span style=color:#ff79c6>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>name</span>: httpbin
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#ff79c6>apiVersion</span>: v1
</span></span><span style=display:flex><span><span style=color:#ff79c6>kind</span>: Service
</span></span><span style=display:flex><span><span style=color:#ff79c6>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>name</span>: httpbin
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>labels</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>app</span>: httpbin
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>service</span>: httpbin
</span></span><span style=display:flex><span><span style=color:#ff79c6>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>ports</span>:
</span></span><span style=display:flex><span>  - <span style=color:#ff79c6>name</span>: http
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>port</span>: <span style=color:#bd93f9>8000</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>targetPort</span>: <span style=color:#bd93f9>80</span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>app</span>: httpbin
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#ff79c6>apiVersion</span>: apps/v1
</span></span><span style=display:flex><span><span style=color:#ff79c6>kind</span>: Deployment
</span></span><span style=display:flex><span><span style=color:#ff79c6>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>name</span>: httpbin
</span></span><span style=display:flex><span><span style=color:#ff79c6>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>replicas</span>: <span style=color:#bd93f9>1</span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>app</span>: httpbin
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>version</span>: v1
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>metadata</span>:
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>labels</span>:
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>app</span>: httpbin
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>version</span>: v1
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>serviceAccountName</span>: httpbin
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>containers</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ff79c6>image</span>: docker.io/kennethreitz/httpbin:latest
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>imagePullPolicy</span>: IfNotPresent
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>name</span>: httpbin
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>ports</span>:
</span></span><span style=display:flex><span>        - <span style=color:#ff79c6>containerPort</span>: <span style=color:#bd93f9>80</span>
</span></span></code></pre></div><p>测试条件：</p><ul><li>在10个命名空间，每个命名空间下5个Pod（4httpbin、1sleep），总共50注入Sidecar的Pod；</li><li>istio-system 命名空间下部署 1000 个 service entry；</li><li>istio-proxy limits：CPU 2c，Memory：1024Mi，requests：CPU：100m，128Mi；</li><li>Istiod limits：CPU 4c，Memory：8Gi，requests：CPU 4c，Memory：8Gi；</li></ul><h2 id=安装-istio-集群>安装 istio 集群</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>istioctl install -f iop.yaml
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ff79c6>apiVersion</span>: install.istio.io/v1alpha1
</span></span><span style=display:flex><span><span style=color:#ff79c6>kind</span>: IstioOperator
</span></span><span style=display:flex><span><span style=color:#ff79c6>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>name</span>: iop-istio
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>namespace</span>: istio-system
</span></span><span style=display:flex><span><span style=color:#ff79c6>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>tag</span>: <span style=color:#bd93f9>1.16.5</span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>namespace</span>: istio-system
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>meshConfig</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>accessLogFile</span>: /dev/stdout
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>defaultConfig</span>:
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>holdApplicationUntilProxyStarts</span>: <span style=color:#ff79c6>true</span>
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>proxyMetadata</span>:
</span></span><span style=display:flex><span>      <span style=color:#6272a4># 开启智能 DNS</span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>ISTIO_META_DNS_CAPTURE</span>: <span style=color:#f1fa8c>&#34;true&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>ISTIO_META_DNS_AUTO_ALLOCATE</span>: <span style=color:#f1fa8c>&#34;true&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#6272a4># 支持多协议</span>
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>proxyStatsMatcher</span>:
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>inclusionPrefixes</span>:
</span></span><span style=display:flex><span>        - thrift
</span></span><span style=display:flex><span>        - dubbo
</span></span><span style=display:flex><span>        - kafka
</span></span><span style=display:flex><span>        - meta_protocol
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>inclusionRegexps</span>:
</span></span><span style=display:flex><span>        - .*dubbo.*
</span></span><span style=display:flex><span>        - .*thrift.*
</span></span><span style=display:flex><span>        - .*kafka.*
</span></span><span style=display:flex><span>        - .*zookeeper.*
</span></span><span style=display:flex><span>        - .*meta_protocol.*
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>values</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>global</span>:
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>meshID</span>: test
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>istioNamespace</span>: istio-system
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>network</span>: gz
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>sidecarInjectorWebhook</span>:
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>rewriteAppHTTPProbe</span>: <span style=color:#ff79c6>false</span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>components</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>ingressGateways</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ff79c6>name</span>: istio-ingressgateway
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>enabled</span>: <span style=color:#ff79c6>false</span>
</span></span></code></pre></div><h2 id=创建-namespace-与工作负载>创建 namespace 与工作负载</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#ff79c6>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>for</span> i in <span style=color:#ff79c6>{</span>1..10<span style=color:#ff79c6>}</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>do</span>
</span></span><span style=display:flex><span>	<span style=color:#8be9fd;font-style:italic>namespace</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;test-</span><span style=color:#8be9fd;font-style:italic>$i</span><span style=color:#f1fa8c>&#34;</span>
</span></span><span style=display:flex><span>	kubectl create namespace <span style=color:#8be9fd;font-style:italic>$namespace</span> <span style=color:#ff79c6>||</span> <span style=color:#8be9fd;font-style:italic>true</span>
</span></span><span style=display:flex><span>	kubectl -n <span style=color:#8be9fd;font-style:italic>$namespace</span> apply -f - <span style=color:#f1fa8c>&lt;&lt;EOF
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>apiVersion: v1
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>kind: ServiceAccount
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>metadata:
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>  name: sleep
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>---
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>apiVersion: v1
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>kind: Service
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>metadata:
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>  name: sleep
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>  labels:
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    app: sleep
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    service: sleep
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>spec:
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>  ports:
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>  - port: 80
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    name: http
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>  selector:
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    app: sleep
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>---
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>apiVersion: apps/v1
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>kind: Deployment
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>metadata:
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>  name: sleep
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>spec:
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>  replicas: 1
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>  selector:
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    matchLabels:
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>      app: sleep
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>  template:
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    metadata:
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>      labels:
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>        app: sleep
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    spec:
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>      terminationGracePeriodSeconds: 0
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>      serviceAccountName: sleep
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>      containers:
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>      - name: sleep
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>        image: docker.io/kennethreitz/httpbin:latest
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>        command: [&#34;/bin/sleep&#34;, &#34;infinity&#34;]
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>        imagePullPolicy: IfNotPresent
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>        volumeMounts:
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>        - mountPath: /etc/sleep/tls
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>          name: secret-volume
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>      volumes:
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>      - name: secret-volume
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>        secret:
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>          secretName: sleep-secret
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>          optional: true
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>for</span> j in <span style=color:#ff79c6>{</span>1..4<span style=color:#ff79c6>}</span>
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>do</span>
</span></span><span style=display:flex><span>		kubectl -n <span style=color:#8be9fd;font-style:italic>$namespace</span> apply -f - <span style=color:#f1fa8c>&lt;&lt;EOF
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>apiVersion: v1
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>kind: ServiceAccount
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>metadata:
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>  name: httpbin
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>---
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>apiVersion: v1
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>kind: Service
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>metadata:
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>  name: httpbin
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>  labels:
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    app: httpbin
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    service: httpbin
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>spec:
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>  ports:
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>  - name: http
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    port: 8000
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    targetPort: 80
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>  selector:
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    app: httpbin
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>---
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>apiVersion: apps/v1
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>kind: Deployment
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>metadata:
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>  name: httpbin-$namespace-$j
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>spec:
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>  replicas: 1
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>  selector:
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    matchLabels:
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>      app: httpbin
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>      version: v1
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>  template:
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    metadata:
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>      labels:
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>        app: httpbin
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>        version: v1
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    spec:
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>      serviceAccountName: httpbin
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>      containers:
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>      - image: docker.io/kennethreitz/httpbin:latest
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>        imagePullPolicy: IfNotPresent
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>        name: httpbin
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>        ports:
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>        - containerPort: 80
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>EOF</span>
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>done</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>done</span>
</span></span></code></pre></div><p><img src=/images/2024-03-09-istio-sidecar-performance-test/1.png alt></p><p><img src=/images/2024-03-09-istio-sidecar-performance-test/2.png alt></p><p><img src=/images/2024-03-09-istio-sidecar-performance-test/3.png alt></p><h2 id=创建-1000-个-serviceentry>创建 1000 个 ServiceEntry</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#ff79c6>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>for</span> i in <span style=color:#ff79c6>{</span>1..1000<span style=color:#ff79c6>}</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>do</span>
</span></span><span style=display:flex><span>  <span style=color:#8be9fd;font-style:italic>entry_name</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;httpbin-entry-</span><span style=color:#8be9fd;font-style:italic>$i</span><span style=color:#f1fa8c>&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#8be9fd;font-style:italic>namespace</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;istio-system&#34;</span>
</span></span><span style=display:flex><span>kubectl -n <span style=color:#8be9fd;font-style:italic>$namespace</span> apply -f - <span style=color:#f1fa8c>&lt;&lt;EOF
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>apiVersion: networking.istio.io/v1alpha3
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>kind: ServiceEntry
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>metadata:
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>  name: $entry_name
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>  namespace: $namespace
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>spec:
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>  hosts:
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>  - httpbin.org
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>  ports:
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>  - number: 80
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    name: http
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    protocol: HTTP
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>  resolution: DNS
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>done</span>
</span></span></code></pre></div><p><img src=/images/2024-03-09-istio-sidecar-performance-test/4.png alt></p><h2 id=未使用-sidecar>未使用 Sidecar</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#6272a4>#查看namespace下pod的运行情况</span>
</span></span><span style=display:flex><span>kubectl -n test-1 get pod  | grep sleep 
</span></span><span style=display:flex><span>sleep-69cdf8667d-p2v7l              2/2     Running   <span style=color:#bd93f9>0</span>          15h
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>#执行以下命令，下载httpbin-0应用所在Pod的Sidecar，保存至本地。</span>
</span></span><span style=display:flex><span>kubectl -n test-1 <span style=color:#8be9fd;font-style:italic>exec</span> -it sleep-69cdf8667d-p2v7l -c istio-proxy -- curl localhost:15000/config_dump &gt; se.json
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>#执行以下命令，查看Sidecar配置文件的大小。</span>
</span></span><span style=display:flex><span>du -sh se_configdump.json
</span></span><span style=display:flex><span>880K	se_configdump.json
</span></span></code></pre></div><h2 id=使用-sidecar>使用 Sidecar</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ff79c6>apiVersion</span>: networking.istio.io/v1beta1
</span></span><span style=display:flex><span><span style=color:#ff79c6>kind</span>: Sidecar
</span></span><span style=display:flex><span><span style=color:#ff79c6>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>name</span>: default
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>namespace</span>: test-1
</span></span><span style=display:flex><span><span style=color:#ff79c6>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>egress</span>:
</span></span><span style=display:flex><span>  - <span style=color:#ff79c6>hosts</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f1fa8c>&#34;test-1/*&#34;</span>
</span></span><span style=display:flex><span>    - <span style=color:#f1fa8c>&#34;istio-system/*&#34;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl -n test-1 <span style=color:#8be9fd;font-style:italic>exec</span> -it sleep-69cdf8667d-ld5n4  -c istio-proxy -- curl localhost:15000/config_dump &gt; with_sidecar_se_configdump.json
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>du -sh with_sidecar_se_configdump.json
</span></span><span style=display:flex><span>580K	with_sidecar_se_configdump.json
</span></span></code></pre></div><p>Istio Sidecar 不加 istio-system 命令空间。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ff79c6>apiVersion</span>: networking.istio.io/v1beta1
</span></span><span style=display:flex><span><span style=color:#ff79c6>kind</span>: Sidecar
</span></span><span style=display:flex><span><span style=color:#ff79c6>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>name</span>: default
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>namespace</span>: test-1
</span></span><span style=display:flex><span><span style=color:#ff79c6>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>egress</span>:
</span></span><span style=display:flex><span>  - <span style=color:#ff79c6>hosts</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f1fa8c>&#34;test-1/*&#34;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>➜  istio-1.16.5 du -sh with_sidecar_se_configdump_no_istio_system.json
</span></span><span style=display:flex><span>196K	with_sidecar_se_configdump_no_istio_system.json
</span></span></code></pre></div><h2 id=在-test-1-下创建-pod查看控制面推送时延>在 test-1 下创建 Pod，查看控制面推送时延</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ff79c6>apiVersion</span>: apps/v1
</span></span><span style=display:flex><span><span style=color:#ff79c6>kind</span>: Deployment
</span></span><span style=display:flex><span><span style=color:#ff79c6>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>name</span>: nginx
</span></span><span style=display:flex><span><span style=color:#ff79c6>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>replicas</span>: <span style=color:#bd93f9>1</span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>app</span>: nginx
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>metadata</span>:
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>labels</span>:
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>app</span>: nginx
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>containers</span>:
</span></span><span style=display:flex><span>        - <span style=color:#ff79c6>name</span>: nginx
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>image</span>: nginx:1.17.3
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>ports</span>:
</span></span><span style=display:flex><span>            - <span style=color:#ff79c6>containerPort</span>: <span style=color:#bd93f9>80</span>
</span></span></code></pre></div><p>存在 Sidecar（带有 istio-system） 的情况下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>2024-04-25T05:33:36.971926Z	info	ads	EDS: PUSH request <span style=color:#ff79c6>for</span> node:nginx-84bfdb5dc4-sd554.test-1 resources:6 size:1.6kB empty:0 cached:6/6
</span></span><span style=display:flex><span>2024-04-25T05:33:36.979920Z	info	ads	LDS: PUSH request <span style=color:#ff79c6>for</span> node:nginx-84bfdb5dc4-sd554.test-1 resources:8 size:41.0kB
</span></span><span style=display:flex><span>2024-04-25T05:33:36.979958Z	info	ads	NDS: PUSH request <span style=color:#ff79c6>for</span> node:nginx-84bfdb5dc4-sd554.test-1 resources:1 size:292B
</span></span><span style=display:flex><span>2024-04-25T05:33:37.022978Z	info	ads	RDS: PUSH request <span style=color:#ff79c6>for</span> node:nginx-84bfdb5dc4-sd554.test-1 resources:4 size:2.6kB cached:4/4
</span></span><span style=display:flex><span>2024-04-25T05:33:37.677824Z	info	ads	CDS: PUSH <span style=color:#ff79c6>for</span> node:nginx-84bfdb5dc4-sd554.test-1 resources:10 size:67.1kB cached:7/7
</span></span><span style=display:flex><span>2024-04-25T05:33:37.677958Z	info	ads	EDS: PUSH <span style=color:#ff79c6>for</span> node:nginx-84bfdb5dc4-sd554.test-1 resources:6 size:1.6kB empty:0 cached:6/6
</span></span><span style=display:flex><span>2024-04-25T05:33:37.679227Z	info	ads	LDS: PUSH <span style=color:#ff79c6>for</span> node:nginx-84bfdb5dc4-sd554.test-1 resources:8 size:41.0kB
</span></span><span style=display:flex><span>2024-04-25T05:33:37.679673Z	info	ads	RDS: PUSH <span style=color:#ff79c6>for</span> node:nginx-84bfdb5dc4-sd554.test-1 resources:4 size:2.6kB cached:4/4
</span></span><span style=display:flex><span>2024-04-25T05:33:37.679737Z	info	ads	NDS: PUSH <span style=color:#ff79c6>for</span> node:nginx-84bfdb5dc4-sd554.test-1 resources:1 size:292B
</span></span></code></pre></div><p>不存在 Sidecar（带有 istio-system） 的情况下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>2024-04-25T05:41:11.461208Z	info	Sidecar injection request <span style=color:#ff79c6>for</span> test-1/nginx-84bfdb5dc4-***** <span style=color:#ff79c6>(</span>actual name not yet known<span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span>2024-04-25T05:41:12.397619Z	info	ads	ADS: new connection <span style=color:#ff79c6>for</span> node:nginx-84bfdb5dc4-gjr74.test-1-257
</span></span><span style=display:flex><span>2024-04-25T05:41:12.400264Z	info	ads	CDS: PUSH request <span style=color:#ff79c6>for</span> node:nginx-84bfdb5dc4-gjr74.test-1 resources:35 size:91.9kB cached:1006/1031
</span></span><span style=display:flex><span>2024-04-25T05:41:12.522927Z	info	ads	EDS: PUSH request <span style=color:#ff79c6>for</span> node:nginx-84bfdb5dc4-gjr74.test-1 resources:31 size:11.1kB empty:1 cached:6/31
</span></span><span style=display:flex><span>2024-04-25T05:41:12.736528Z	info	ads	LDS: PUSH request <span style=color:#ff79c6>for</span> node:nginx-84bfdb5dc4-gjr74.test-1 resources:15 size:68.4kB
</span></span><span style=display:flex><span>2024-04-25T05:41:12.736940Z	info	ads	NDS: PUSH request <span style=color:#ff79c6>for</span> node:nginx-84bfdb5dc4-gjr74.test-1 resources:1 size:2.3kB
</span></span><span style=display:flex><span>2024-04-25T05:41:12.767528Z	info	ads	RDS: PUSH request <span style=color:#ff79c6>for</span> node:nginx-84bfdb5dc4-gjr74.test-1 resources:8 size:13.4kB cached:8/8
</span></span><span style=display:flex><span>2024-04-25T05:41:13.264996Z	info	ads	CDS: PUSH <span style=color:#ff79c6>for</span> node:nginx-84bfdb5dc4-gjr74.test-1 resources:35 size:91.9kB cached:1006/1031
</span></span><span style=display:flex><span>2024-04-25T05:41:13.265818Z	info	ads	EDS: PUSH <span style=color:#ff79c6>for</span> node:nginx-84bfdb5dc4-gjr74.test-1 resources:31 size:11.1kB empty:1 cached:6/31
</span></span><span style=display:flex><span>2024-04-25T05:41:13.267125Z	info	ads	LDS: PUSH <span style=color:#ff79c6>for</span> node:nginx-84bfdb5dc4-gjr74.test-1 resources:15 size:68.4kB
</span></span><span style=display:flex><span>2024-04-25T05:41:13.267757Z	info	ads	RDS: PUSH <span style=color:#ff79c6>for</span> node:nginx-84bfdb5dc4-gjr74.test-1 resources:8 size:13.4kB cached:8/8
</span></span><span style=display:flex><span>2024-04-25T05:41:13.268017Z	info	ads	NDS: PUSH <span style=color:#ff79c6>for</span> node:nginx-84bfdb5dc4-gjr74.test-1 resources:1 size:2.3kB
</span></span></code></pre></div><h2 id=测试结论>测试结论</h2><p>以下为使用Sidecar资源优化前后的效果对比。</p><table><thead><tr><th>规模</th><th>类型</th><th>配置</th><th>使用 Sidecar</th><th>未使用 Sidecar</th></tr></thead><tbody><tr><td>50 Pod</td><td>1000 SE</td><td>Sidecar配置大小</td><td>580K</td><td>880K</td></tr><tr><td>50 Pod</td><td>1000 SE</td><td>控制平面配置推送时间</td><td>0.7s</td><td>1.8s</td></tr></tbody></table><p>结论：在 istio-system 命名空间下部署 1000 个 service entry；50个注入Sidecar的Pod；Istiod 资源4c8Gi（request 与 limis 相等）情况下测试数据：</p><ul><li>Sidecar配置大小从880K降到580K，下降34%，随着Sidecar规模增加，下降的效果越明显；</li><li>控制平面配置推送时间从1.8s降到0.7s，下降61.1%，随着Sidecar规模增加，下降的效果越明显；</li></ul><h1 id=参考>参考</h1><ol><li><a href="https://help.aliyun.com/zh/asm/user-guide/effects-of-sidecar-recommendation-on-configuration-push-optimization?spm=a2c4g.11186623.0.0.6b1b6a46LET3Bd">effects-of-sidecar-recommendation-on-configuration-push-optimization</a></li></ol><hr><ul class=pager><li class=previous><a href=/post/2024-01-09-kubernetes-coredns/ data-toggle=tooltip data-placement=top title="Kubernetes CoreDNS 核心原理和源码解析">&larr;
Previous Post</a></li><li class=next><a href=/post/2024-04-06-scheduler-framework-01/ data-toggle=tooltip data-placement=top title="深入理解 Kubernetes Scheduler Framework 调度框架（Part 1）">Next
Post &rarr;</a></li></ul></div><div class="col-lg-2 col-lg-offset-0
visible-lg-block
sidebar-container
catalog-container"><div class=side-catalog><hr class="hidden-sm hidden-xs"><h5><a class=catalog-toggle href=#>CATALOG</a></h5><ul class=catalog-body></ul></div></div><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
sidebar-container"></div></div></div></article><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center"><li><a href=mailto:tanjunchen20@gmail.com><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-envelope fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=/img/wechat.jpg><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-weixin fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=https://github.com/tanjunchen><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-github fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="copyright text-muted">Copyright &copy; 陈谭军 2024</p></div></div></div></footer><script>function loadAsync(e,t){var s=document,o="script",n=s.createElement(o),i=s.getElementsByTagName(o)[0];n.src=e,t&&n.addEventListener("load",function(e){t(null,e)},!1),i.parentNode.insertBefore(n,i)}</script><script>$("#tag_cloud").length!==0&&loadAsync("/js/jquery.tagcloud.js",function(){$.fn.tagcloud.defaults={color:{start:"#bbbbee",end:"#0085a1"}},$("#tag_cloud a").tagcloud()})</script><script>loadAsync("https://cdn.jsdelivr.net/npm/fastclick@1.0.6/lib/fastclick.min.js",function(){var e=document.querySelector("nav");e&&FastClick.attach(e)})</script><script type=text/javascript>function generateCatalog(e){_containerSelector="div.post-container";var t,n,s,o,i,r=$(_containerSelector),a=r.find("h1,h2,h3,h4,h5,h6");return $(e).html(""),a.each(function(){n=$(this).prop("tagName").toLowerCase(),i="#"+$(this).prop("id"),s=$(this).text(),t=$('<a href="'+i+'" rel="nofollow">'+s+"</a>"),o=$('<li class="'+n+'_nav"></li>').append(t),$(e).append(o)}),!0}generateCatalog(".catalog-body"),$(".catalog-toggle").click(function(e){e.preventDefault(),$(".side-catalog").toggleClass("fold")}),loadAsync("/js/jquery.nav.js",function(){$(".catalog-body").onePageNav({currentClass:"active",changeHash:!1,easing:"swing",filter:"",scrollSpeed:700,scrollOffset:0,scrollThreshold:.2,begin:null,end:null,scrollChange:null,padding:80})})</script></body></html>